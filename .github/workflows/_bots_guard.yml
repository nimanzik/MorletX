name: Guard CI when PR is from bot accounts

on:
  workflow_call:
    outputs:
      is_bot_pr:
        description: "Indicates if the PR is created by a bot account"
        value: ${{ jobs.guard.outputs.result }}

jobs:
  guard:
    runs-on: ubuntu-latest
    steps:
      - id: check
        run: |
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            PR_USER="${{ github.event.pull_request.user.login }}"
            echo "| DEBUG | PR created by: $PR_USER"

            if [[ "$PR_USER" == "dependabot[bot]" || "$PR_USER" == "dependabot" || \
                  "$PR_USER" == "pre-commit-ci[bot]" || "$PR_USER" == "pre-commit-ci" || \
                  "$PR_USER" == "mend-bolt-for-github[bot]" || "$PR_USER" == "mend-bolt-for-github" ]]; then
              echo "is_bot_pr=true" >> $GITHUB_OUTPUT
            else
              echo "is_bot_pr=false" >> $GITHUB_OUTPUT
            fi
          else
            echo "is_bot_pr=false" >> $GITHUB_OUTPUT
          fi
    outputs:
      result: ${{ steps.check.outputs.is_bot_pr }}
